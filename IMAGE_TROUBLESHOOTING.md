# Устранение проблем с изображениями

## Проблема: Показывается только оригинальное изображение

### Возможные причины:

1. **Pexels API ключ не настроен**
   - Функция `search_image_from_pexels()` возвращает `None` без API ключа
   - **Решение:** Добавьте `PEXELS_API_KEY` в `Backend/BOT_TOKEN.env` или используйте Unsplash (работает без ключа)

2. **Unsplash Source API не работает**
   - Unsplash Source API может быть ограничен или недоступен
   - **Решение:** Используйте Pexels API ключ

3. **Kandinsky генерация не работает**
   - Неправильный API endpoint или отсутствие разрешений
   - **Решение:** Проверьте логи бэкенда при генерации

---

## Как проверить, что происходит:

### 1. Проверьте логи бэкенда:

После отправки запроса на рерайт статьи, в логах бэкенда должны быть строки:

```
INFO:__main__:Начинаем получение изображений...
INFO:__main__:Извлечение изображения из оригинальной статьи...
INFO:__main__:Оригинальное изображение: найдено/не найдено
INFO:__main__:Поиск изображения через API для запроса: ...
INFO:__main__:Изображение из API: найдено/не найдено
INFO:__main__:Генерация изображения через Kandinsky с промптом: ...
INFO:__main__:Сгенерированное изображение: получено/не получено
INFO:__main__:Итоговые изображения: original=True/False, pexels=True/False, generated=True/False
```

### 2. Проверьте ответ API:

Откройте консоль браузера (F12) → Network → найдите запрос `/api/rewrite-article` → посмотрите Response:

```json
{
  "success": true,
  "images": {
    "original": "https://...",
    "pexels": null,
    "generated": null
  }
}
```

---

## Решения:

### Решение 1: Настройка Pexels API (рекомендуется)

1. Зарегистрируйтесь на https://www.pexels.com/api/
2. Получите API ключ
3. Добавьте в `Backend/BOT_TOKEN.env`:
   ```env
   PEXELS_API_KEY=ваш_ключ
   ```
4. Перезапустите бэкенд

### Решение 2: Использование Unsplash (без ключа)

Unsplash уже добавлен как fallback. Если Pexels не работает, автоматически используется Unsplash.

**Ограничения:**
- Unsplash Source API может быть медленным
- Может не работать для всех запросов

### Решение 3: Проверка Kandinsky API

1. Проверьте, что `YANDEX_CLOUD_API_KEY` есть в `Backend/BOT_TOKEN.env`
2. Убедитесь, что у API ключа есть разрешения для работы с Foundation Models
3. Проверьте логи бэкенда - там будет детальная ошибка

**Если Kandinsky не работает:**
- Используйте оригинальное или Pexels изображение
- Или настройте другой сервис генерации изображений

---

## Альтернативные варианты:

### Вариант 1: Использовать только оригинальное изображение

Если другие варианты не нужны, можно отключить их в коде.

### Вариант 2: Добавить другой API для поиска изображений

Можно добавить:
- **Pixabay API** (бесплатный, 100 запросов/минуту)
- **Lorem Picsum** (случайные изображения)
- **Placeholder.com** (заглушки)

### Вариант 3: Использовать локальные изображения

Можно добавить папку с изображениями-заглушками и выбирать случайное.

---

## Проверка работы:

1. Перезапустите бэкенд
2. Откройте консоль браузера (F12)
3. Введите URL статьи и отправьте запрос
4. Проверьте:
   - Логи в консоли браузера
   - Логи бэкенда
   - Ответ API в Network tab

---

## Если ничего не помогает:

1. Проверьте, что бэкенд запущен и доступен
2. Проверьте, что все зависимости установлены
3. Проверьте логи бэкенда на наличие ошибок
4. Убедитесь, что интернет-соединение работает (для API запросов)

