# Устранение ошибок авторизации

## Ошибка: "Ошибка авторизации"

### Возможные причины:

1. **Токен истек** (действителен 5 минут)
2. **Ошибка связи с сервером** (бэкенд не запущен или недоступен)
3. **Бот не может подключиться к API**

## Диагностика

### 1. Проверьте, что бэкенд запущен

В терминале с бэкендом должны быть видны запросы:
```
INFO:werkzeug:127.0.0.1 - - [12/Dec/2025 19:32:33] "POST /api/auth/authorize HTTP/1.1" 200 -
```

Если запросов нет - бот не может подключиться к API.

### 2. Проверьте логи бота

В терминале с ботом должны быть логи:
```
INFO:__main__:Попытка авторизации пользователя XXXXX с токеном abc123...
INFO:__main__:API URL: http://localhost:5000/api/auth/authorize
INFO:__main__:Ответ API: статус 200, тело: {"success":true}
```

Если видите ошибки соединения - проверьте:
- Запущен ли бэкенд
- Правильный ли API_URL в боте (по умолчанию `http://localhost:5000`)

### 3. Проверьте логи бэкенда

При нажатии кнопки "Авторизоваться на сайте" в боте должны появиться логи:
```
INFO:__main__:Получен запрос на авторизацию токена: abc123...
INFO:__main__:Данные пользователя: {'id': 123456789, 'first_name': 'Имя', ...}
INFO:__main__:Токен abc123... успешно авторизован для пользователя 123456789
```

### 4. Проверьте настройки API_URL

Убедитесь, что в боте правильный URL API. По умолчанию используется `http://localhost:5000`.

Если бэкенд запущен на другом адресе, добавьте в `Backend/BOT_TOKEN.env`:
```
API_URL=http://localhost:5000
```

## Решение проблем

### Проблема: "Токен истек"

**Решение:**
1. Закройте меню авторизации на сайте
2. Откройте снова - будет сгенерирован новый токен
3. Быстро перейдите в бота и нажмите "Авторизоваться на сайте"

### Проблема: "Ошибка связи с сервером"

**Решение:**
1. Убедитесь, что бэкенд запущен (`python Backend/server.py`)
2. Проверьте, что бэкенд слушает на порту 5000
3. Проверьте логи бота на наличие ошибок соединения
4. Убедитесь, что `API_URL` в боте правильный

### Проблема: Бот не может подключиться к API

**Решение:**
1. Проверьте, что бэкенд запущен и доступен
2. Проверьте логи бота - должны быть сообщения о попытке подключения
3. Если используете другой адрес, обновите `API_URL` в `Backend/BOT_TOKEN.env`

## Проверка работы

1. Откройте сайт и меню авторизации
2. Нажмите "Открыть бота для авторизации"
3. В боте нажмите "Авторизоваться на сайте"
4. Проверьте логи:
   - **Бот:** Должны увидеть "Попытка авторизации..." и "Результат авторизации: True"
   - **Бэкенд:** Должны увидеть "Получен запрос на авторизацию..." и "Токен ... успешно авторизован"
5. Вернитесь на сайт - вы должны быть авторизованы

## Дополнительная информация

Если проблема сохраняется, проверьте:
- Все три компонента запущены (бэкенд, бот, фронтенд)
- Нет ошибок в консоли браузера (F12)
- Нет ошибок в логах бота и бэкенда

